<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>配置文件预处理 | Clash for Windows</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="by Fndroid">
    
    <link rel="preload" href="/assets/css/0.styles.06281dfd.css" as="style"><link rel="preload" href="/assets/js/app.b76825e2.js" as="script"><link rel="preload" href="/assets/js/3.d473e987.js" as="script"><link rel="preload" href="/assets/js/28.812f3769.js" as="script"><link rel="prefetch" href="/assets/js/10.dbecdfd7.js"><link rel="prefetch" href="/assets/js/11.831e815a.js"><link rel="prefetch" href="/assets/js/12.ba06751f.js"><link rel="prefetch" href="/assets/js/13.523f8f79.js"><link rel="prefetch" href="/assets/js/14.ad336070.js"><link rel="prefetch" href="/assets/js/15.5f7ec38a.js"><link rel="prefetch" href="/assets/js/16.ad0fea17.js"><link rel="prefetch" href="/assets/js/17.6069bfb0.js"><link rel="prefetch" href="/assets/js/18.e441d0cf.js"><link rel="prefetch" href="/assets/js/19.3788f273.js"><link rel="prefetch" href="/assets/js/20.9adc183a.js"><link rel="prefetch" href="/assets/js/21.de4beb65.js"><link rel="prefetch" href="/assets/js/22.65ebe795.js"><link rel="prefetch" href="/assets/js/23.5ab710b4.js"><link rel="prefetch" href="/assets/js/24.76199c3b.js"><link rel="prefetch" href="/assets/js/25.fb11fc37.js"><link rel="prefetch" href="/assets/js/26.2cde84a9.js"><link rel="prefetch" href="/assets/js/27.9ecab65d.js"><link rel="prefetch" href="/assets/js/29.4733cfbb.js"><link rel="prefetch" href="/assets/js/30.ab4b3f8d.js"><link rel="prefetch" href="/assets/js/31.7772c1ce.js"><link rel="prefetch" href="/assets/js/32.f65a51e2.js"><link rel="prefetch" href="/assets/js/33.2edf6707.js"><link rel="prefetch" href="/assets/js/34.73c02750.js"><link rel="prefetch" href="/assets/js/35.a92d9c98.js"><link rel="prefetch" href="/assets/js/36.ded2537b.js"><link rel="prefetch" href="/assets/js/37.2e89dee8.js"><link rel="prefetch" href="/assets/js/4.9b8aa3f8.js"><link rel="prefetch" href="/assets/js/5.59308a93.js"><link rel="prefetch" href="/assets/js/6.e64ec4ee.js"><link rel="prefetch" href="/assets/js/7.86b4a017.js"><link rel="prefetch" href="/assets/js/8.a5464943.js"><link rel="prefetch" href="/assets/js/9.9b8a234a.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.999f295f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.06281dfd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Clash for Windows</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/Fndroid/clash_for_windows_pkg/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Download the APP
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/Fndroid/clash-win-docs-new" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/Fndroid/clash_for_windows_pkg/releases" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Download the APP
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/Fndroid/clash-win-docs-new" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/" class="sidebar-heading clickable router-link-active open"><span>Clash for Windows</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/contents/quickstart.html" class="sidebar-link">快速上手</a></li><li><a href="/contents/configfile.html" class="sidebar-link">配置文件</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/contents/ui" class="sidebar-heading clickable"><span>界面组成</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/contents/urlscheme.html" class="sidebar-link">URL Scheme</a></li><li><a href="/contents/bypass.html" class="sidebar-link">绕过系统代理</a></li><li><a href="/contents/breakconn.html" class="sidebar-link">打断连接</a></li><li><a href="/contents/7z.html" class="sidebar-link">便携模式</a></li><li><a href="/contents/tun.html" class="sidebar-link">TUN 模式</a></li><li><a href="/contents/tap.html" class="sidebar-link">TAP 模式</a></li><li><a href="/contents/mixin.html" class="sidebar-link">Mixin</a></li><li><a href="/contents/parser.html" aria-current="page" class="active sidebar-link">配置文件预处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/contents/parser.html#版本要求" class="sidebar-link">版本要求</a></li><li class="sidebar-sub-header"><a href="/contents/parser.html#简便方法-yaml" class="sidebar-link">简便方法（YAML）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/contents/parser.html#参数说明" class="sidebar-link">参数说明</a></li><li class="sidebar-sub-header"><a href="/contents/parser.html#commands-使用方法-beta" class="sidebar-link">Commands 使用方法（beta）</a></li></ul></li><li class="sidebar-sub-header"><a href="/contents/parser.html#进阶方法-javascript" class="sidebar-link">进阶方法（JavaScript）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/contents/parser.html#参数说明-2" class="sidebar-link">参数说明</a></li><li class="sidebar-sub-header"><a href="/contents/parser.html#返回说明" class="sidebar-link">返回说明</a></li></ul></li><li class="sidebar-sub-header"><a href="/contents/parser.html#多处理器及正则匹配" class="sidebar-link">多处理器及正则匹配</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/contents/parser.html#正则匹配" class="sidebar-link">正则匹配</a></li><li class="sidebar-sub-header"><a href="/contents/parser.html#多处理器" class="sidebar-link">多处理器</a></li></ul></li></ul></li><li><a href="/contents/profilespath.html" class="sidebar-link">自定义配置目录</a></li><li><a href="/contents/childprocess.html" class="sidebar-link">启动其他应用</a></li><li><a href="/contents/trayicon.html" class="sidebar-link">自定义状态栏图标</a></li><li><a href="/contents/font.html" class="sidebar-link">自定义字体</a></li><li><a href="/contents/proxyorder.html" class="sidebar-link">自定义节点排序</a></li><li><a href="/contents/header.html" class="sidebar-link">自定义请求头</a></li><li><a href="/contents/mac.html" class="sidebar-link">macOS 特性</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="配置文件预处理"><a href="#配置文件预处理" class="header-anchor">#</a> 配置文件预处理</h1> <h2 id="版本要求"><a href="#版本要求" class="header-anchor">#</a> 版本要求</h2> <p>0.10.1 版本更新后，支持使用 JavaScript 对下载后的配置文件进行预处理</p> <p>0.11.10 版本更新后，支持使用 YAML 对下载后配置文件进行简单预处理</p> <h2 id="简便方法-yaml"><a href="#简便方法-yaml" class="header-anchor">#</a> 简便方法（YAML）</h2> <p>如果需要对下载地址为<code>https://example.com/profile.yaml</code>的配置文件进行预处理，操作如下：</p> <ol><li>进入 Settings 界面</li> <li>滚动至 Profiles 栏</li> <li>点击 Parsers 右边 Edit 打开编辑器，填入：<div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">parsers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.com/profile.yaml
    <span class="token key atrule">yaml</span><span class="token punctuation">:</span>
      <span class="token key atrule">prepend-rules</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> DOMAIN<span class="token punctuation">,</span>test.com<span class="token punctuation">,</span>DIRECT <span class="token comment"># rules最前面增加一个规则</span>
      <span class="token key atrule">append-proxies</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> test <span class="token comment"># proxies最后面增加一个服务</span>
          <span class="token key atrule">type</span><span class="token punctuation">:</span> http
          <span class="token key atrule">server</span><span class="token punctuation">:</span> 123.123.123.123
          <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">456</span>
</code></pre></div></li> <li>点击编辑器右下角保存按钮</li></ol> <p>当配置文件触发刷新（包括自动更新）时，CFW 会读取<code>yaml</code>字段定义的值，将对应值插入/合并到原配置文件中</p> <h3 id="参数说明"><a href="#参数说明" class="header-anchor">#</a> 参数说明</h3> <table><thead><tr><th>键</th> <th>值类型</th> <th>操作</th></tr></thead> <tbody><tr><td>append-rules</td> <td>数组</td> <td>数组合并至原配置<code>rules</code>数组<strong>后</strong></td></tr> <tr><td>prepend-rules</td> <td>数组</td> <td>数组合并至原配置<code>rules</code>数组<strong>前</strong></td></tr> <tr><td>append-proxies</td> <td>数组</td> <td>数组合并至原配置<code>proxies</code>数组<strong>后</strong></td></tr> <tr><td>prepend-proxies</td> <td>数组</td> <td>数组合并至原配置<code>proxies</code>数组<strong>前</strong></td></tr> <tr><td>append-proxy-groups</td> <td>数组</td> <td>数组合并至原配置<code>proxy-groups</code>数组<strong>后</strong></td></tr> <tr><td>prepend-proxy-groups</td> <td>数组</td> <td>数组合并至原配置<code>proxy-groups</code>数组<strong>前</strong></td></tr> <tr><td>mix-proxy-providers</td> <td>对象</td> <td>对象合并至原配置<code>proxy-providers</code>中</td></tr> <tr><td>mix-rule-providers</td> <td>对象</td> <td>对象合并至原配置<code>rule-providers</code>中</td></tr> <tr><td>mix-object</td> <td>对象</td> <td>对象合并至原配置最外层中</td></tr> <tr><td>commands</td> <td>数组</td> <td>在上面操作完成后执行简单命令操作配置文件</td></tr></tbody></table> <h3 id="commands-使用方法-beta"><a href="#commands-使用方法-beta" class="header-anchor">#</a> Commands 使用方法（beta）</h3> <p>commands 是一组简单的命令，作为上面操作的补充</p> <p>例子:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">commands</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> dns.enable=false <span class="token comment"># 命令1</span>
  <span class="token punctuation">-</span> proxy<span class="token punctuation">-</span>groups.0.proxies.0+DIRECT <span class="token comment"># 命令2</span>
</code></pre></div><p>每个命令可以被分为三个部分，分别是：<strong>定位+操作+设定值</strong></p> <p>命令 1 中，定位是<code>dns.enable</code>，操作是<code>=</code>，设定值是<code>false</code></p> <p>命令 2 中，定位是<code>proxy-groups.0.proxies.2</code>，操作是<code>+</code>，设定值是<code>DIRECT</code></p> <h4 id="定位"><a href="#定位" class="header-anchor">#</a> 定位</h4> <p>定位中每个层级以<code>.</code>分割，数组类型的定位下标由 0 开始计算，命令 2 中<code>proxy-groups.0</code>即表示定位至第 1 个策略组，<code>.proxies</code>表示访问第一个策略组的 proxies 属性，<code>.proxies.2</code>表示 proxies 属性的第 3 个位置</p> <p>如果不想用序号定位，也可以使用<code>name</code>值定位，<code>proxies</code>以及<code>proxy-groups</code>中的每个项目都会有<code>name</code>属性。例如在<code>proxies</code>中已经定义了名为<code>debug</code>的节点，那么修改其<code>udp</code>参数的定位即为<code>proxies.(debug).udp</code>，名称两边的<code>()</code>是保证识别，如果节点名不包括<code>+</code>、<code>.</code>或<code>=</code>这几个符号，也可以省略不写</p> <h4 id="操作"><a href="#操作" class="header-anchor">#</a> 操作</h4> <p>目前支持三种操作：</p> <ul><li><code>=</code>：覆盖</li> <li><code>+</code>：插入</li> <li><code>-</code>：删除</li></ul> <p>命令 1 中，<code>=</code>表示将<code>dns</code>下<code>enable</code>的值覆盖为<code>false</code></p> <p>命令 2 中，<code>+</code>表示在定位的策略组中的<code>proxies</code>数组中添加一个名为<code>DIRECT</code>的值，原本其他值被向后移动 1 位。如果此处改成<code>=</code>，则会覆盖原来第一个值</p> <h4 id="设定值"><a href="#设定值" class="header-anchor">#</a> 设定值</h4> <p>设定值是用于插入或覆盖的值，如果操作是<code>-</code>，则此值可有可无，例如：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">commands</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> proxies.0<span class="token punctuation">-</span> <span class="token comment"># 命令3</span>
</code></pre></div><p>此处可以将配置文件<code>proxies</code>的第 1 个节点删除</p> <p>如果设定值为纯数字，则会被识别为整数，为<code>true|false</code>则识别为布尔类型，如果 JSON 编码通过则识别为对象</p> <p>v0.13.7 版本更新后，支持 3 个内置值用于设置策略组节点，分别是<code>[]proxyNames</code>，<code>[]groupNames</code>和<code>[]shuffledProxyNames</code>，并支持使用正则过滤其中节点，例子如下：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">yaml</span><span class="token punctuation">:</span>
  <span class="token key atrule">prepend-proxy-groups</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myGroup <span class="token comment"># 建立新策略组</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> fallback
      <span class="token key atrule">url</span><span class="token punctuation">:</span> <span class="token string">&quot;http://www.gstatic.com/generate_204&quot;</span>
      <span class="token key atrule">interval</span><span class="token punctuation">:</span> <span class="token number">300</span>
      <span class="token key atrule">proxies</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> DIRECT

  <span class="token key atrule">commands</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> proxy<span class="token punctuation">-</span>groups.myGroup.proxies=<span class="token punctuation">[</span><span class="token punctuation">]</span>proxyNames<span class="token punctuation">|</span>HK <span class="token comment"># 向策略组添加所有定义的节点名，并按“HK”正则表达式过滤</span>
</code></pre></div><h2 id="进阶方法-javascript"><a href="#进阶方法-javascript" class="header-anchor">#</a> 进阶方法（JavaScript）</h2> <p>如果需要对下载地址为<code>https://example.com/profile.yaml</code>的配置文件进行预处理，操作如下：</p> <ol><li>进入 Settings 界面</li> <li>滚动至 Profiles 栏</li> <li>点击 Parsers 右边 Edit 打开编辑器，填入：<div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">parsers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.com/profile.yaml
    <span class="token key atrule">code</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
      module.exports.parse = async (raw, { axios, yaml, notify, console }, { name, url, interval, selected }) =&gt; {
        const obj = yaml.parse(raw)
        return yaml.stringify(obj)
      }</span>
</code></pre></div></li> <li>点击编辑器右下角保存按钮</li></ol> <p>当配置文件触发刷新（包括自动更新）时，CFW 会调用此方法对下载的配置文件内容进行处理，再写入本地文件中</p> <p>当然，parsers 也支持使用路径引入代码：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">parsers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.com/profile.yaml
    <span class="token key atrule">file</span><span class="token punctuation">:</span> <span class="token string">&quot;C:/Users/cfw/parser.js&quot;</span>
</code></pre></div><h3 id="参数说明-2"><a href="#参数说明-2" class="header-anchor">#</a> 参数说明</h3> <p>CFW 调用用户定义的<code>parse</code>方法时，会传入 3 个参数，分别是<strong>配置文件文本内容</strong>，<strong>工具类对象/方法</strong>以及<strong>配置文件元数据</strong></p> <h4 id="配置文件文本内容"><a href="#配置文件文本内容" class="header-anchor">#</a> 配置文件文本内容</h4> <p>raw 是一个字符串，一般需要用 yaml 库解析成 JavaScript 对象</p> <h4 id="工具类对象-方法"><a href="#工具类对象-方法" class="header-anchor">#</a> 工具类对象/方法</h4> <p>包括：</p> <ul><li>axios：网络请求框架，<a href="https://github.com/axios/axios" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>yaml：yaml 框架，<a href="https://github.com/eemeli/yaml" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>notify：发出系统通知方法，签名为<code>function notify(title:string, message:string, silent:bool)</code></li> <li>console：日志输出至文件，方便调试，在 Settings 界面中 Parser 设置下方打开</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>除了以上工具类，在使用<code>.js</code>文件时，也可以通过<code>npm</code>引入第三方模块</p></div> <h4 id="配置文件元数据"><a href="#配置文件元数据" class="header-anchor">#</a> 配置文件元数据</h4> <p>元数据为 JavaScript 对象，包括：</p> <ul><li>name：名称</li> <li>url：下载地址</li> <li>interval：更新周期</li> <li>selected：策略组选择缓存，数组</li> <li>mode：模式缓存</li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>元数据在配置文件首次下载时为空对象</p></div> <h3 id="返回说明"><a href="#返回说明" class="header-anchor">#</a> 返回说明</h3> <p><code>parse</code>方法需要返回一个字符串，CFW 会将返回的字符串存入对应的配置文件中</p> <h2 id="多处理器及正则匹配"><a href="#多处理器及正则匹配" class="header-anchor">#</a> 多处理器及正则匹配</h2> <h3 id="正则匹配"><a href="#正则匹配" class="header-anchor">#</a> 正则匹配</h3> <p>上面例子中，使用<code>url</code>匹配配置文件地址，如果一个处理器需要处理多个配置文件，也可以使用正则表达式进行匹配，使用关键字<code>reg</code>设置</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">parsers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">reg</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//test.com.+$ <span class="token comment"># 正则匹配域名</span>
    <span class="token key atrule">yaml</span><span class="token punctuation">:</span>
      <span class="token key atrule">prepend-rules</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> DOMAIN<span class="token punctuation">,</span>test.com<span class="token punctuation">,</span>DIRECT
</code></pre></div><h3 id="多处理器"><a href="#多处理器" class="header-anchor">#</a> 多处理器</h3> <p>parser 定义的数组支持多个处理器从上至下按顺序执行，例如：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">parsers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">reg</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//test.com.+$ <span class="token comment"># 第一个执行的parser</span>
    <span class="token key atrule">file</span><span class="token punctuation">:</span> <span class="token string">&quot;C:/Users/cfw/parser.yaml&quot;</span>
  <span class="token punctuation">-</span> <span class="token key atrule">url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//example.com/profile.yaml <span class="token comment"># 对上一个parser执行的结果进行处理</span>
    <span class="token key atrule">file</span><span class="token punctuation">:</span> <span class="token string">&quot;C:/Users/cfw/parser.js&quot;</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>file 同时支持 yaml 及 js 格式的文件</p></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Fndroid/clash-win-docs-new/edit/master/docs/contents/parser.md" target="_blank" rel="noopener noreferrer">在Github上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">1/29/2021, 3:01:14 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/contents/mixin.html" class="prev">
        Mixin
      </a></span> <span class="next"><a href="/contents/profilespath.html">
        自定义配置目录
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.b76825e2.js" defer></script><script src="/assets/js/3.d473e987.js" defer></script><script src="/assets/js/28.812f3769.js" defer></script>
  </body>
</html>
